package com.sap.cloud.sdk.tutorial;

import java.util.List;

import org.junit.BeforeClass;
import org.junit.Test;
import org.mockito.Mockito;


import com.google.common.collect.Lists;
import com.sap.cloud.sdk.cloudplatform.connectivity.HttpDestination;
import com.sap.cloud.sdk.tutorial.utils.GetBusinessPartnersCommand;
import com.sap.cloud.sdk.tutorial.vdm.namespaces.businesspartner.BusinessPartner;
import com.sap.cloud.sdk.tutorial.vdm.services.APIBUSINESSPARTNERService;

import static org.junit.Assert.assertEquals;
import static org.mockito.Mockito.RETURNS_DEEP_STUBS;
import static org.mockito.Mockito.any;
import static org.mockito.Mockito.when;



public class GetMockedBusinessPartnersCommand {
    private static BusinessPartner alice;
    private static BusinessPartner bob;

    @BeforeClass
    public static void beforeClass() throws Exception {

        alice = new BusinessPartner();
        alice.setFirstName("Alice");

        bob = new BusinessPartner();
        bob.setFirstName("Bob");
    }

    @Test
    public void testGetBusinessPartners() throws Exception {
        final APIBUSINESSPARTNERService service = Mockito.mock(APIBUSINESSPARTNERService.class, RETURNS_DEEP_STUBS);
        final HttpDestination httpDestination = Mockito.mock(HttpDestination.class);

        when(service.getAllBusinessPartner()
                .filter(any())
                .select(any())
                .executeRequest(any()))
                .thenReturn(Lists.newArrayList(alice, bob));

        final List<BusinessPartner> businessPartners = new GetBusinessPartnersCommand(httpDestination, service).execute();

        assertEquals(2, businessPartners.size());
        assertEquals("Alice", businessPartners.get(0).FIRST_NAME);
        assertEquals("Bob", businessPartners.get(1).FIRST_NAME);
    }
}
